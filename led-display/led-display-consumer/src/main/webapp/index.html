<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<title>Insert title here</title>

</head>
<body>

	<canvas id="canvas" width="300" height="20800"></canvas>

	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
		integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g="
		crossorigin="anonymous"></script>
	<script>
		(function($) {
			$.QueryString = (function(a) {
				if (a == "")
					return {};
				var b = {};
				for (var i = 0; i < a.length; ++i) {
					var p = a[i].split('=', 2);
					if (p.length != 2)
						continue;
					b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
				}
				return b;
			})(window.location.search.substr(1).split('&'))
		})(jQuery);

		$(document).ready(
				function() {
					var matrixId = $.QueryString.matrixId
					var socket = new WebSocket(
							"ws://localhost:8080/led-display-consumer/live/"
									+ matrixId);
					socket.onmessage = onMessage;

					function onMessage(event) {
						var matrix = JSON.parse(event.data);
						 var canvas = document.getElementById('canvas');
						  if (canvas.getContext) {
						    var ctx = canvas.getContext('2d');
						    
						    var frames = matrix.compiledFrames;
						    for(var frameIndex in frames) {
						    	var frameData = frames[frameIndex].frameData;
						    	for(var dataIndex in frameData) {
						    		var datas = frameData[dataIndex];
						    		for(var i = 0; i < datas.data.length; i++) {
						    			var led = datas.data[i];
						    			var red = led.rgbColor.r;
						    			var green = led.rgbColor.g;
						    			var blue = led.rgbColor.b;
						    			var color = 'rgb(' + red + ', ' + green + ', ' + blue + ')';
						    			ctx.fillStyle = color;
						    		    ctx.fillRect(i * 25, (dataIndex * 25) + (frameIndex * 6 * 25), 25, 25);
						    		}
						    	}
						    }
						  }
					}
				});
	</script>
</body>
</html>